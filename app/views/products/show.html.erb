<div class="container" id="content-left-right">
  <div class="content-left">
    <%= render :partial => 'products/index/filters_online', :locals => {:countries => @countries} %>
  </div>
  <div class="content-right">
    <div id="main-content" class="movie-block block100">
      <h1 class="block100 padb10 dark-blue">
        <div class="col-lg-8 col-md-8 col-sm-8 col-xs-12"><%= "#{@product_title} (#{@product.year})" %>
          <span class="block100 Arial f16 mart5 normal"><%= @product.categories.active(params[:kind]).collect { |category| "#{link_to(category.name, category_products_path(:category_id => category))}" }.join(', ').html_safe %></span>
        </div>
        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
          <div class="block100 slide-score <%= params[:kind] == :adult ? "violet" : "#{@product.tvod? ? "blue" : "green"}" %> mart5 f20" data-score="<%= @product.rating_count %>"></div>
          <span class="block100 Arial f16 mart5 normal text-right"><%= t('.count') %> <%= @product.rating_count %></span>
        </div>
      </h1>
      <div class="cover-list-view">
        <%= image_tag(@product_image, :class => "img-responsive radius4") %>
        <% if @product.hd?(session[:country_id]) %>
            <span class="hd position-absolute black white-bck radius2 bold italic">HD</span>
        <% end %>
      </div>
      <div class="text-list-view dark-gray">
        <% actors = @product.actors.collect { |actor| link_to(actor.name, actor_products_path(:actor_id => actor.to_param), :class => "f13") }.join(', ').html_safe %>
        <% if actors.size > 0 %>
            <div class="block100">
              <h5 class="block100 f16 mart0 bold marb5"><%= t '.actors' %></h5>
              <%= actors %>
            </div>
        <% end %>
        <% if @product.studio && @product.adult? %>
            <div class="block100 mart5">
              <h5 class="display-inline f16 mart0 bold marb5"><%= t('.studio') %></h5>
              <%= link_to(@product.studio.name, studio_products_path(:studio_id => @product.studio.to_param), :class => "f13") %>
            </div>
        <% end %>
        <% if @product.director && !@product.adult? %>
            <div class="block100 mart5">
              <h5 class="display-inline f16 mart0 bold marb5"><%= t('.directed_by') %></h5>
              <%= link_to(@product.director.name, director_products_path(:director_id => @product.director.to_param), :class => "f13") %>
            </div>
        <% end %>
        <div class="block100 mart5">
          <h5 class="display-inline f16 mart0 bold marb5"><%= t '.country' %></h5>
          <span class="marl5 light-gray f13"><%= @product.country.name if @product.country %></span>
        </div>
        <div class="block100 mart5">
          <h5 class="display-inline f16 mart0 bold marb5"><%= t '.audience' %></h5>
          <span class="marl5 light-gray f13"><%= @product.public.name %></span>
        </div>
        <div class="block100 mart5">
          <h5 class="display-inline f16 mart0 bold marb5"><%= t '.duration' %></h5>
          <span class="marl5 light-gray f13"><%= "#{@product.runtime} #{t '.minutes'}" %></span>
        </div>
        <div class="block100 mart5">
          <h5 class="display-inline f16 mart0 bold marb5"><%= t '.picture' %></h5>
          <span class="marl5 light-gray f13"><%= @product.picture_format.name if @product.picture_format %></span>
        </div>
        <div class="block100 mart5">
          <h5 class="display-inline f16 mart0 bold marb5"><%= t '.sound' %></h5>
          <span class="marl5 light-gray f13">-</span>
        </div>
        <% if !@product_description.products_awards.empty? %>
            <div id="festival">
              <h5 class="display-inline f16 mart0 bold marb5"><%= t('.awards') %></h5>
              <%= render :partial => 'products/show/awards', :locals => {:product => @product, :size => 'small'} %>
            </div>
        <% end %>
      </div>
      <div class="block100">
        <h3 class="OpenSansCondensed f25 dark-blue pad0 padl5"><%= t '.synopsis' %></h3>
        <span class="light-gray f13"><%= @product_description.text.to_s.html_safe %></span>
        <div class="block100 mart5">
          <%= link_to(product_trailer_path(:product_id => @product.to_param, :source => @source, :response_id => @response_id), :class => 'btn white center-block dark-gray-bck btn-trailer', remote: true) do %>
              <i class="fa fa-film marr5"></i><%= t('.trailer') %>
          <% end %>
        </div>
      </div>
      <% if @product.series? %>
          <%= render :partial => 'products/show/serie_formats', :locals => {:product => @product, :svod_date => @svod_date} %>
      <% else %>
          <%= render :partial => 'products/show/formats', :locals => {:product => @product, :svod_date => @svod_date} %>
      <% end %>
      <div class="block100">
        <h3 class="OpenSansCondensed f25 dark-blue pad0 padl5"><%= t '.photo' %></h3>
        <%= render :partial => 'products/show/preview', :locals => {:product => @product, :type => params[:kind], :source => @source, :response_id => @response_id} %>
      </div>
      <% if customer_signed_in? %>
          <% @recommendations = ActiveRecord::Base.connection.exec_query %Q{CALL sp_movie_to_movie(#{current_customer.to_param}, #{@product.imdb_id})} %>
      <% else %>
          <% @recommendations = ActiveRecord::Base.connection.exec_query %Q{CALL sp_movie_to_movie(#{0}, #{@product.imdb_id})} %>
      <% end %>
      <% ActiveRecord::Base.clear_active_connections! %>
      <% if @recommendations.any? %>
          <div id="slider-view" class="block100">
            <div class="home-carousel-holder center-block">
              <h3 class="OpenSansCondensed f25 dark-blue pad0 padl5"><%= t("recommendations_show") %></h3>
              <section class="responsive-carousel slider">

                <% @recommendations.each do |r| %>
                    <% product = Product.find(r["products_id"]) %>
                    <div>
                      <% if params[:kind].present? && params[:kind] == :adult %>
                          <a href="<%= product_path(:id => r["products_id"]) %>" class="popper"><img src="<%= "http://www.dvdpost.be/imagesx/#{r["image"]}" %>" class="img-responsive">
                            <% if product.hd?(session[:country_id]) %>
                                <span class="hd position-absolute black white-bck radius2 bold italic">HD</span>
                            <% end %>
                          </a>
                      <% else %>
                          <a href="<%= product_path(:id => r["products_id"]) %>" class="popper"><img src="<%= "http://www.dvdpost.be/images/#{r["image"]}" %>" class="img-responsive">
                            <% if product.hd?(session[:country_id]) %>
                                <span class="hd position-absolute black white-bck radius2 bold italic">HD</span>
                            <% end %>
                          </a>
                      <% end %>

                      <!--synopsys-->
                      <div class="synopsys-content">
                        <div class="position-relative pull-left">
                          <h4 class="dark-gray mart20 marb0 bold text-center uppercase f25"><%= product.smart_title %> (<%= product.year %>)</h4>
                          <div class="block100 slide-score <%= params[:kind] == :adult ? "violet" : "#{product.tvod? ? "blue" : "green"}" %> text-center mart5 f20" data-score="<%= product.rating_count %>"></div>
                          <% if customer_signed_in? %>
                              <% if current_customer.unlimted_subscriber? %>
                                  <% if product.tvod? %>
                                      <% if product.streaming_products.any? %>
                                          <% if current_customer.tvod_free > 0 %>
                                              <div class="block100 slide-price f20 line-height-10 dark-gray text-center bold">
                                                <%= product.streaming_products.first.tvod_credits %> credits
                                              </div>
                                          <% else %>
                                              <div class="block100 slide-price f20 line-height-10 dark-gray text-center bold">
                                                <%= product.streaming_products.first.ppv_price %> €
                                              </div>
                                          <% end %>
                                      <% end %>
                                  <% end %>
                              <% elsif current_customer.plush_la_carte_subscriber? || current_customer.customers_abo_type == 6 %>
                                  <% unless ((current_customer.abo_type_id == 6 && current_customer.activation_discount_code_type == "A" && Mobistar.find_by_activation_id(current_customer.activation_discount_code_id) && current_customer.tvod_free > 0) || (current_customer.unlimted_subscriber? && product.svod?)) %>
                                      <% if product.streaming_products.any? %>
                                          <% if current_customer.customers_abo_type == 6 && current_customer.tvod_free == 0 %>
                                              <div class="block100 slide-price f20 line-height-10 dark-gray text-center bold">
                                                <%= product.streaming_products.first.tvod_price %> €
                                              </div>
                                          <% elsif current_customer.customers_abo_type == 6 && current_customer.tvod_free > 0 %>
                                              <div class="block100 slide-price f20 line-height-10 dark-gray text-center bold">
                                                <%= product.streaming_products.first.tvod_credits %> credits
                                              </div>
                                          <% elsif current_customer.plush_la_carte_subscriber? %>
                                              <div class="block100 slide-price f20 line-height-10 dark-gray text-center bold">
                                                <%= product.streaming_products.first.tvod_credits %> credits
                                              </div>
                                          <% end %>
                                      <% end %>
                                  <% end %>
                              <% end %>
                          <% else %>
                              <% if product.streaming_products.any? %>
                                  <div class="block100 slide-discount text-center mart5"><%= t('products.show.product.popup_chose') %> <%= product.streaming_products.first.ppv_price %>
                                    € <%= t('products.show.product.popup_via') %>
                                    <%= link_to t('products.show.product.popup2'), info_path(:page_name => product.tvod? ? t('routes.infos.params.alacarte') : t('routes.infos.params.unlimited')), :class => "dark-gray underline" %>
                                  </div>
                              <% end %>
                          <% end %>
                          <div class="block100 slide-content mart15 text-center">
                            <%= render :partial => 'products/streaming', :locals => {:product => product, :source => @source, :popup => true} %>
                          </div>
                          <div class="block100 slide-content mart15">
                            <%= truncate_html((product.description_data.text rescue '...'), :length => 500) %>
                          </div>
                          <%= render :partial => 'products/vod_list', :locals => {:product => product, :source => @source, :response_id => @response_id} %>
                          <% unless (customer_signed_in? && current_customer.unlimted_subscriber?) %>
                              <% if product.streaming_products.any? %>
                                  <% if customer_signed_in? %>
                                      <% if current_customer.tvod_only? %>
                                          <% if (current_customer.abo_type_id == 6 && current_customer.activation_discount_code_type == "A") && (Mobistar.find_by_activation_id(current_customer.activation_discount_code_id) && current_customer.tvod_free > 0) %>
                                              <div class="block100 slide-footer <%= params[:kind] == :adult ? "violet-bck" : "#{product.svod? ? "green-bck" : "blue-bck"}" %> padtb15 mart10 text-center">
                                                <%= link_to info_path(:page_name => t('routes.infos.params.alacarte')), :class => "underline f18 dark-gray" do %>
                                                    <%= t('products.show.product.popup4').html_safe %>
                                                <% end %>
                                              </div>
                                          <% else %>
                                              <% if product.svod? %>
                                                  <div class="block100 slide-footer <%= params[:kind] == :adult ? "violet-bck" : "blue-bck" %> padtb15 mart10 text-center">
                                                    <%= link_to info_path(:page_name => t('routes.infos.params.unlimited')), :class => "underline f18 dark-gray" do %>
                                                        <%= t('products.show.product.popup9').html_safe %>
                                                    <% end %>
                                                    <p class="block100 mart5 text-center dark-gray f15">
                                                      <%= t('products.show.product.popup10').html_safe %>
                                                    </p>
                                                  </div>
                                              <% end %>
                                              <% if product.tvod? %>
                                                  <div class="block100 slide-footer <%= params[:kind] == :adult ? "violet-bck" : "green-bck" %> padtb15 mart10 text-center">
                                                    <%= link_to info_path(:page_name => t('routes.infos.params.alacarte')), :class => "underline f18 dark-gray" do %>
                                                        <%= t('products.show.product.popup6').html_safe %>
                                                    <% end %>
                                                    <p class="block100 mart5 text-center dark-gray f15">
                                                      <%= t('products.show.product.popup7').html_safe %>
                                                      <strong><%= product.streaming_products.first.ppv_price %>€</strong>
                                                    </p>
                                                  </div>
                                              <% end %>
                                          <% end %>
                                      <% elsif current_customer.plush_la_carte_subscriber? %>
                                          <div class="block100 slide-footer <%= params[:kind] == :adult ? "violet-bck" : "#{product.svod? ? "green-bck" : "blue-bck"}" %> padtb15 mart10 text-center">
                                            <a class="underline f18 dark-gray" onclick='jQuery.facebox("<%= escape_javascript(render(:partial => 'products/tvod_credits_only', :locals => {:product => product, :season_id => product.season_id, :episode_id => product.episode_id, :source => @source})) %>");'><%= t('products.show.product.popup4').html_safe %></a>
                                          </div>
                                      <% end %>
                                  <% else %>
                                      <% if product.svod? %>
                                          <div class="block100 slide-footer <%= params[:kind] == :adult ? "violet-bck" : "green-bck" %> padtb15 mart10 text-center">
                                            <%= link_to info_path(:page_name => t('routes.infos.params.unlimited')), :class => "underline f18 dark-gray" do %>
                                                <%= t('products.show.product.popup9').html_safe %>
                                            <% end %>
                                            <p class="block100 mart5 text-center dark-gray f15">
                                              <%= t('products.show.product.popup10').html_safe %>
                                            </p>
                                          </div>
                                      <% end %>
                                      <% if product.tvod? %>
                                          <div class="block100 slide-footer <%= params[:kind] == :adult ? "violet-bck" : "blue-bck" %> padtb15 mart10 text-center">
                                            <%= link_to info_path(:page_name => t('routes.infos.params.alacarte')), :class => "underline f18 dark-gray" do %>
                                                <%= t('products.show.product.popup6').html_safe %></u></label>
                                            <% end %>
                                            <p class="block100 mart5 text-center dark-gray f15">
                                              <%= t('products.show.product.popup7').html_safe %>
                                              <strong><%= product.streaming_products.first.ppv_price %>€</strong>
                                            </p>
                                          </div>
                                      <% end %>
                                  <% end %>
                              <% end %>
                          <% end %>
                          <a href="" class="synopsys-adaptive-close"></a>
                        </div>
                      </div>
                      <!--/synopsys-->
                      <a href="" class="position-absolute white-bck pad10 radius2 synopsys-adaptive-open f17 green uppercase no-underline"><i class="fa fa-search-plus f25 marr5"></i>Details
                      </a>
                    </div>
                <% end %>
              </section>
            </div>
          </div>
      <% end %>


    </div>

  </div>
</div>