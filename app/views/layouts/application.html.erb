<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" CONTENT="index, follow">
  <meta http-equiv="content-language" content="<%= I18n.locale %>"/>
  <meta http-equiv="content-type" content="text/html;charset=utf-8"/>
  <meta name="description" content="<%= @meta_description.blank? ? '' : @meta_description %>"/>
  <title><%= h @meta_title.blank? ? t('.title') : @meta_title %></title>
  <%= include_gon(namespace: 'Plush') %>
  <%= Gon::Base.render_data %>
  <% Gon.global.current_customer = current_customer if !customer_signed_in? %>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <%= stylesheet_link_tag "application", :media => "all" %>
  <script src="https://content.jwplatform.com/libraries/D6L08XhR.js"></script>
  <%= javascript_include_tag "application" %>
   <link rel="manifest" href="manifest.json">
<body id="<%= @body_id %>" class="<%= params[:kind] %> <%= current_customer ? :private : :public %> <%= I18n.locale %> <%= @body_class %>">
<div class="canavas" id="">
  <% if params[:controller] == "products" %>
      <%= render "layouts/application/filters_open_adaptive" %>
  <% end %>
  <%= render "layouts/application/side_menu_box_shadov" %>
  <div class="wrap">
    <%= render "layouts/header" %>
    <div id="content" class="<%= configure_content_div_html_class(params) %>">
          <%= render "layouts/promo_banner" %>
      <%= yield %>
    </div>
    <% cache("layouts_footer_#{I18n.locale}", :expires_in => 15.minutes) do %>
        <%= render "layouts/footer" %>
    <% end %>
  </div>
</div>
<script>
    $(document).ready(function () {

      $(window).scroll(function() {
         if($(window).scrollTop() + window.innerHeight == $(document).height()) {
             console.log("bottom!");
         }
      });

        $("#green_banner_form").submit(function (event) {
            event.preventDefault();
            $.ajax({
                method: 'POST',
                url: '/api/v1/promotion_code_activation',
                data: {
                    'promotion': $("#promotion").val()
                },
                dataType: 'json',
                success: function (response) {
                    if (1 === response.status) {
                        jQuery.facebox("<div class=\"alert alert-danger\">" +
                            "<strong>" + response.message + "</strong>" +
                            "</div>");
                    } else if (2 === response.status) {
                        window.location.href = response.message;
                    }
                }
            });
        });

        $("#left_sidebar_promotion_form").submit(function (event) {
            event.preventDefault();
            $.ajax({
                method: 'POST',
                url: '/api/v1/promotion_code_activation',
                data: {
                    'promotion': $("#promotion_code_ls").val()
                },
                dataType: 'json',
                success: function (response) {
                    if (1 === response.status) {
                        jQuery.facebox("<div class=\"alert alert-danger\">" +
                            "<strong>" + response.message + "</strong>" +
                            "</div>");
                    } else if (2 === response.status) {
                        window.location.href = response.message;
                    }
                }
            });
        });

        $("#load_more").click(function(e) {
            e.preventDefault();
            $.ajax({
                url: $('.next_page:last').attr('href'),
                dataType: 'script'
            });
        });
        $(document).ready(function() {
            $(".dropdown-toggle").dropdown();
        });
    });

    jQuery.fn.extend({
        toggleText: function (a, b) {
            var isClicked = false;
            var that = this;
            this.click(function () {
                if (isClicked) {
                    that.html(a);
                    isClicked = false;
                }
                else {
                    that.html(b);
                    isClicked = true;
                }
            });
            return this;
        }
    });


    $(document).ready(function () {
        "use strict"; // Start of use strict

        function mainSidemenuState(state) {
            switch (state) {
                case 'on':
                    $(".canavas").addClass('on');
                    $("#overlay").addClass('on');
                    break;
                case 'off':
                    $(".canavas").removeClass('on');
                    $("#overlay").removeClass('on');
                    break;
            }
        }

        function filtersPanelState(state) {
            $('.content-left #filters-open-adaptive .fa').toggleClass("fa-arrow-up fa-arrow-down");
            switch (state) {
                case 'on':
                    $('#filters-open-adaptive').addClass('on');
                    $('.content-left').addClass('on');
                    $("#overlay").addClass('on');
                    break;
                case 'off':
                    $('#filters-open-adaptive').removeClass('on');
                    $('.content-left').removeClass('on');
                    $("#overlay").removeClass('on');
                    break;
            }
        }

        $('.canavas').waitForImages(function () {
            $('.canavas').fadeIn('1000');
        });

        $(".side-menu-close").on('click', function () {
            mainSidemenuState('off');
        });

        $(".navbar-toggle").on('click', function () {
            mainSidemenuState('on');
        });

        $(window).resize(function () {
            //checkMq();
            //mainSidemenuState('off');
            //filtersPanelState('off');
        });

        $('.navbar-default').affix({
            offset: {
                top: 80
            }
        });

        $('#on-top').affix({
            offset: {
                top: 380
            }
        });

        $('#on-top').on('click', function (event) {
            $(this).removeClass('affix');
            $('html, body').animate({scrollTop: 0}, '500');
        });

        $(".top-header > div").clone().appendTo(".side-menu-login");
        $(".navbar-collapse").clone().appendTo(".side-menu-nav");
        $(".top-search-holder").clone().appendTo(".side-menu-search");

        $('#user-status-switch').on('click', function () {
            $('.panel-enter-code, .top-green-status').toggleClass('on');
            return false;
        }).toggleText('<i class="fa fa-copy marr5"></i><a href="#" id="promo-code-open" class="no-decoration">(voir tout)</a>', '<i class="fa fa-minus marr5"></i><a href="#" id="promo-code-open" class="no-decoration"> (minimiser)</a>');


        $('#left-promo-code-trigger').on('click', function (e) {
            $('.left-promo-code').toggleClass("on");
            $('#left-promo-code-trigger .fa-caret-down').toggleClass("white");
            e.preventDefault();
        });

        $('#filters-open-adaptive').on('click', function () {
            $(this).toggleClass("green");
            if ($('.content-left').is(".on")) {
                filtersPanelState('off');
            } else {
                filtersPanelState('on');
                $(".canavas").removeClass('on');
            }
        });

        $('.chosen-select').chosen({allow_single_deselect: false});

    });

    window.onload = function () {


        //$("#pagination").hide();
        if (typeof(Storage) !== "undefined") {
            if (gon && gon.current_customer === null && localStorage.getItem("plush_temporary_email") !== null) {
                $.ajax({
                    method: 'POST',
                    //url: '/orange/lu/api/automatic_login',
                    data: {
                        'plush_phone_number': localStorage.getItem("plush_phone_number")
                    },
                    dataType: 'json',
                    success: function (response) {
                        if (0 === response.status) {
                            $(".login-holder").empty();
                            if (gon && gon.locale === "fr") {
                                autoLoginMenuFR = "<li>" +
                                    "<a href=\"/fr/mon-compte/sign_out\" data-method=\"delete\" id=\"logout\" rel=\"nofollow\">Déconnexion</a> <span>(4dae@plush.temp)</span>" +
                                    "</li>" +
                                    "<li>" +
                                    "<a href='fr/mon-compte/' + response.current_customer_id + '>Mon compte</a>" +
                                    "</li>";
                                $(".login-holder").html(autoLoginMenuFR);
                            } else if (gon && gon.locale === "nl") {
                                autoLoginMenuNL = "<li>" +
                                    "<a href=\"/nl/mijn-account/sign_out\" data-method=\"delete\" id=\"logout\" rel=\"nofollow\">Uitloggen</a> <span>(4dae@plush.temp)</span>" +
                                    "</li>" +
                                    "<li>" +
                                    "<a href='/nl/mijn-account/' + response.current_customer_id + '>Mijn account</a>" +
                                    "</li>";
                                $(".login-holder").html(autoLoginMenuNL);
                            } else if (gon && gon.locale === "en") {
                                autoLoginMenuEN = "<li>" +
                                    "<a href=\"/en/my-account/sign_out\" data-method=\"delete\" id=\"logout\" rel=\"nofollow\">Log out</a> <span>(4dae@plush.temp)</span>" +
                                    "</li>" +
                                    "<li>" +
                                    "<a href='/en/my-account/' + response.current_customer_id + '>My account</a>" +
                                    "</li>";
                                $(".login-holder").html(autoLoginMenuEN);
                            }
                        }
                    },
                    error: function (response) {
                        console.log('CHECKED AJAX ERROR!!!');
                    }
                });
            }
        } else {
            console.log("Sorry! No Web Storage support..");
        }
    };

    $(document).ready(function () {

        $('a[rel*=facebox]').facebox();

        var originalLeave = $.fn.popover.Constructor.prototype.leave;
        $.fn.popover.Constructor.prototype.leave = function (obj) {
            var self = obj instanceof this.constructor ? obj : $(obj.currentTarget)[this.type](this.getDelegateOptions()).data('bs.' + this.type);
            originalLeave.call(this, obj);

            if (obj.currentTarget) {
                self.$tip.one('mouseenter', function () {
                    clearTimeout(self.timeout);
                    self.$tip.one('mouseleave', function () {
                        $.fn.popover.Constructor.prototype.leave.call(self, self);
                    });
                })
            }
        };

        function popoverTrig() {
            $('.popper').popover({
                placement: "left",
                trigger: "hover",
                container: 'body',
                html: true,
                delay: {
                    show: 300,
                    hide: 100
                },
                content: function () {
                    return $(this).next('.synopsys-content').html();
                }
            })
        };

        // home slider
        $('.responsive-carousel').slick({
            dots: false,
            infinite: false,
            speed: 200,
            slidesToShow: 4,
            slidesToScroll: 2,
            responsive: [
                {
                    breakpoint: 980,
                    settings: {
                        slidesToShow: 3,
                        slidesToScroll: 2,
                    }
                },
                {
                    breakpoint: 600,
                    settings: {
                        slidesToShow: 2,
                        slidesToScroll: 1
                    }
                }
            ]
        });

        //raty stars
        $('.slide-score').raty({
            readOnly: true,
            score: function () {
                return $(this).attr('data-score');
            }
        });

        // synopsis adaptive trigg open
        $('.synopsys-adaptive-open').on('click', function () {
            $('.synopsys-adaptive-open').removeClass('hidden');
            $(this).addClass('hidden');
            $('.synopsys-content').removeClass('on');
            $(this).prev('.synopsys-content').addClass('on');
            return false;
        })

        // synopsis adaptive trigg close
        $('.synopsys-adaptive-close').on('click', function () {
            $(this).closest('.slick-slide').children('.synopsys-adaptive-open').removeClass('hidden');
            $(this).closest('.grid-slide').children('.synopsys-adaptive-open').removeClass('hidden');
            $(this).closest('.synopsys-content').removeClass('on');

            return false;
        })

        // modernizr
        function checkModernizr() {
            if (Modernizr.mq('(min-width: 981px)')) {
                popoverTrig();
                fancyboxBinder();
            }
            if (Modernizr.mq('(max-width: 980px)')) {
                $('.popper').popover('destroy');
                fancyboxUnBinder();
            }
        }

        // the call to checkMq here will execute after the document has loaded
        checkModernizr();

        $(window).resize(function () {
            checkModernizr();
        });

        $('.tags-autocomplete-holder li.ui-menu-item').on('click', function (e) {
            e.preventDefault();
        });

        function fancyboxBinder() {
            $(".fancybox").unbind('click')
            $("a.fancybox").fancybox({
                padding: 5,
                helpers: {
                    overlay: {
                        locked: false,
                        overlayShow: true
                    }
                },
            })
        }

        function fancyboxUnBinder() {
            $.fancybox.close();
            $(".fancybox").bind('click', function (e) {
                e.preventDefault();
            })
            $(document).unbind('click.fb-start');
        }

    });

    $(".icheckbox,.iradio").iCheck({
        checkboxClass: 'icheckbox_minimal-grey',
        radioClass: 'iradio_minimal-grey'
    });
</script>
<script>
$(document).ready(function () {

    History = window.History;

    if ($('#online #filters').html()) {


        load_form();

        // MAIN TOP BUTTONS START !!!

        $('#products_index, #film-details, #categories, #studios').delegate('#online #date_filters_year_min, #online  #date_filters_year_max', "change", function () {
            submit_online()
        });

        $('#products_index, #film-details, #categories, #studios').delegate('.packages.svod, .packages.tvod', 'click', function () {
            $('#filter_online_form').attr('action', $(this).attr('href'));
            $('.packages').removeClass('current');
            $(this).addClass('current');
            submit_online();
            return false;
        });

        $(".icheckbox,.iradio").iCheck({
            checkboxClass: 'icheckbox_minimal-grey',
            radioClass: 'iradio_minimal-grey'
        });

        $('.iradio').on('ifChecked', function (e) {
            submit_online();
        });

        $(document).on('click', '.filter-close', function (e) {
            var form_element = $(this).closest('.applied-filter-tag').attr('data-input-element');

            if (form_element === "Plush à la Carte") {

                $(".reset-applied-filters").trigger("click");

            } else if (form_element === "Plush Unlimited") {

                $(".reset-applied-filters").trigger("click");

            } else if (form_element === "Derniers ajouts" || form_element === "Laatste aanwinsten" || form_element === "Newly added") {

                $('.iradio').iCheck('uncheck');
                submit_online();

            } else if (form_element === "Les plus populaires" || form_element === "Meest bekeken" || form_element === "Most viewed") {

                $('.iradio').iCheck('uncheck');
                submit_online();

            } else if (form_element === "Dernière chance" || form_element === "Laatste kans" || form_element === "Last chance") {

                $('.iradio').iCheck('uncheck');
                submit_online();

            } else if (form_element === "Les mieux côtés" || form_element === "Beste beoordeeld" || form_element === "Best rated") {

                $('.iradio').iCheck('uncheck');
                submit_online();

            } else if (form_element === "Bientôt disponible" || form_element === "Binnenkort beschikbaar" || form_element === "Coming soon") {

                $('.iradio').iCheck('uncheck');
                submit_online();

            } else if (form_element === "Nouveautés" || form_element === "Nieuwe films" || form_element === "New movies") {

                $('.iradio').iCheck('uncheck');
                submit_online();

            } else if (form_element === "Haute Définition" || form_element === "High Definition") {

                $('.iradio').iCheck('uncheck');
                submit_online();

            }

            console.log(form_element);
        });

        $('#products_index, #film-details, #categories, #studios').delegate("#close_audience", "click", function () {
            $("#online #audience-slider-range").slider("values", [0, 4])
        });

        $('#products_index, #film-details').delegate("#close_country", "click", function () {
            $('#online #filters_country_id').val('').trigger('chosen:updated');
            submit_online()
        });

        $('#products_index, #film-details, #categories, #studios').delegate("#close_year", "click", function () {
            $("#online #date_filters_year_min").val($("#online #date_filters_year_min option:first").val());
            $("#online #date_filters_year_max").val($("#online #date_filters_year_min option:last").val());
            submit_online()
        });

        $('#products_index').delegate("#close_ratings", "click", function () {
            $("#ratings-slider-range").slider("values", [0, 18])
        });

        $('#products_index').delegate("#close_audios", "click", function () {
            $('#online #filters_audio').val('audio...').trigger('chosen:updated');
            submit_online()
        });

        $('#products_index').delegate("#close_subtitles", "click", function () {
            $('#online #filters_subtitles').val('sub...').trigger('chosen:updated');
            submit_online()
        });

        $('#products_index').delegate("#close_category", "click", function () {
            $('#online #filters_category_id').val('').trigger('chosen:updated');
            submit_online()
        });

        $('#products_index').delegate("#close_actor", "click", function () {
            $('#filter_online_form').attr('action', $(this).attr('url'))
            submit_online()
        })
        $('#products_index').delegate("#close_director", "click", function () {
            $('#filter_online_form').attr('action', $(this).attr('url'))
            submit_online()
        });

        $('#products_index').delegate("#close_view_mode", "click", function () {
            $('.links').prop('checked', false);
            submit_online()
        });

        $('#products_index').delegate("#close_belgium", "click", function () {
            $('#filter_online_form #belgium').val('')

            submit_online()
        });

        $('#products_index').delegate("#pagination.deactive a", "click", function () {
            ajax_pagination($(this).attr('href'))
            return false
        });


    }

    if ($('.edit_search_filter #filters').html()) {
        $("#filters ul li a").on("click", function () {
            $(this).parent().toggleClass('open');
            $(this).parent().children("div").toggle();
            return false;
        });
        audience_slider_values = {'0': 0, '10': 1, '12': 2, '16': 3, '18': 4};
        $("#audience-slider-range").slider({
            range: true,
            min: 0,
            max: 4,
            values: [audience_slider_values[$("#search_filter_audience_min").val()], audience_slider_values[$("#search_filter_audience_max").val()]],
            step: 1,
            slide: function (event, ui) {
                actual_audience_values = {'0': 0, '1': 10, '2': 12, '3': 16, '4': 18};
                $("#search_filter_audience_min").val(actual_audience_values[ui.values[0]]);
                $("#search_filter_audience_max").val(actual_audience_values[ui.values[1]]);
            }
        });
        $("#ratings-slider-range").slider({
            range: true,
            min: 1,
            max: 5,
            values: [$("#online #search_filter_rating_min").val(), $("#online #search_filter_rating_max").val()],
            step: 1,
            slide: function (event, ui) {
                $("#online #search_filter_rating_min").val(ui.values[0]);
                $("#online #search_filter_rating_max").val(ui.values[1]);
            }
        });
        $('#products_index').delegate(".categorie_online", "click", function () {

            return false
        })
    }
    History.Adapter.bind(window, 'statechange', function () { // Note: We are using statechange instead of popstate
        // Log the State
        var State = History.getState(); // Note: We are using History.getState() instead of event.state
        $('.loading_bar').show()
        $.ajax({
            url: State.url,
            dataType: 'script',
            type: 'GET',
            data: {},
            success: function (data) {
            },
            error: function () {
            }
        });
    })
});


function submit_online() {
    if ($('.not_reload').length > 0) {
        if ($('#filter_online_form').attr('action').indexOf('?') > 0) {
            history_url = $('#filter_online_form').attr('action') + "&" + $('#filter_online_form').serialize()
        }
        else {
            history_url = $('#filter_online_form').attr('action') + "?" + $('#filter_online_form').serialize()
        }
        History.pushState(null, null, history_url);
    }
    else {
        $('#filter_online_form').submit();
    }
}

function load_form() {

    $('.chosen-select').chosen({allow_single_deselect: true}).change(function () {
        submit_online();
    });

    $("#online #ratings-slider-range").slider({
        range: true,
        min: 1,
        max: 5,
        values: [$("#filters_rating_min").val(), $("#filters_rating_max").val()],
        step: 1,
        change: function (event, ui) {
            $("#online #filters_rating_min").val(ui.values[0]);
            $("#online #filters_rating_max").val(ui.values[1]);
            submit_online()
        }
    });
    audience_slider_values = {'0': 0, '10': 1, '12': 2, '16': 3, '18': 4};
    $("#online #audience-slider-range").slider({
        range: true,
        min: 0,
        max: 4,
        values: [audience_slider_values[$("#online #filters_audience_min").val()], audience_slider_values[$("#online #filters_audience_max").val()]],
        step: 1,
        change: function (event, ui) {
            actual_audience_values = {'0': 0, '1': 10, '2': 12, '3': 16, '4': 18};
            $("#online #filters_audience_min").val(actual_audience_values[ui.values[0]]);
            $("#online #filters_audience_max").val(actual_audience_values[ui.values[1]]);
            submit_online()
        }
    });
}

</script>
</body>
</html>
