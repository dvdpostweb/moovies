<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" CONTENT="index, follow">
  <meta http-equiv="content-language" content="<%= I18n.locale %>"/>
  <meta http-equiv="content-type" content="text/html;charset=utf-8"/>
  <meta name="description" content="<%= @meta_description.blank? ? '' : @meta_description %>"/>
  <title><%= h @meta_title.blank? ? t('.title') : @meta_title %></title>
  <%= include_gon(namespace: 'Plush') %>
  <%= Gon::Base.render_data %>
  <% Gon.global.current_customer = current_customer if !customer_signed_in? %>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <%= stylesheet_link_tag "application", :media => "all" %>
  <%= yield :view_specific_css %>
  <script src="https://content.jwplatform.com/libraries/D6L08XhR.js"></script>
  <%= javascript_include_tag "application" %>
</head>
<body id="<%= @body_id %>" class="<%= params[:kind] %> <%= current_customer ? :private : :public %> <%= I18n.locale %> <%= @body_class %>">
<div class="canavas" id="">
  <% if params[:controller] == "products" %>
      <%= render "layouts/application/filters_open_adaptive" %>
  <% end %>
  <%= render "layouts/application/side_menu_box_shadov" %>
  <div class="wrap">
    <%= render "layouts/header" %>
    <div id="content" class="<%= configure_content_div_html_class(params) %>">
      <%= render "layouts/promo_banner" %>
      <%= yield %>
    </div>
    <% cache("layouts_footer_#{I18n.locale}", :expires_in => 15.minutes) do %>
        <%= render "layouts/footer" %>
    <% end %>
  </div>
</div>
<script>
    $(document).ready(function () {
        $("#green_banner_form").submit(function (event) {
            event.preventDefault();
            $.ajax({
                method: 'POST',
                url: '/api/v1/promotion_code_activation',
                data: {
                    'promotion': $("#promotion").val()
                },
                dataType: 'json',
                success: function (response) {
                    if (1 === response.status) {
                        jQuery.facebox("<div class=\"alert alert-danger\">" +
                            "<strong>" + response.message + "</strong>" +
                            "</div>");
                    } else if (2 === response.status) {
                        window.location.href = response.message;
                    }
                }
            });
        });
        $("#load_more").click(function(e) {
            e.preventDefault();
            $.ajax({
                url: $('.next_page:last').attr('href'),
                dataType: 'script'
            });
        });
        $(document).ready(function() {
            $(".dropdown-toggle").dropdown();
        });
    });

    jQuery.fn.extend({
        toggleText: function (a, b) {
            var isClicked = false;
            var that = this;
            this.click(function () {
                if (isClicked) {
                    that.html(a);
                    isClicked = false;
                }
                else {
                    that.html(b);
                    isClicked = true;
                }
            });
            return this;
        }
    });


    $(document).ready(function () {
        "use strict"; // Start of use strict

        function mainSidemenuState(state) {
            switch (state) {
                case 'on':
                    $(".canavas").addClass('on');
                    $("#overlay").addClass('on');
                    break;
                case 'off':
                    $(".canavas").removeClass('on');
                    $("#overlay").removeClass('on');
                    break;
            }
        }

        function filtersPanelState(state) {
            $('.content-left #filters-open-adaptive .fa').toggleClass("fa-arrow-up fa-arrow-down");
            switch (state) {
                case 'on':
                    $('#filters-open-adaptive').addClass('on');
                    $('.content-left').addClass('on');
                    $("#overlay").addClass('on');
                    break;
                case 'off':
                    $('#filters-open-adaptive').removeClass('on');
                    $('.content-left').removeClass('on');
                    $("#overlay").removeClass('on');
                    break;
            }
        }

        $('.canavas').waitForImages(function () {
            $('.canavas').fadeIn('1000');
        });

        $(".side-menu-close").on('click', function () {
            mainSidemenuState('off');
        });

        $(".navbar-toggle").on('click', function () {
            mainSidemenuState('on');
        });

        $(window).resize(function () {
            //checkMq();
            //mainSidemenuState('off');
            //filtersPanelState('off');
        });

        $('.navbar-default').affix({
            offset: {
                top: 80
            }
        });

        $('#on-top').affix({
            offset: {
                top: 380
            }
        });

        $('#on-top').on('click', function (event) {
            $(this).removeClass('affix');
            $('html, body').animate({scrollTop: 0}, '500');
        });

        $(".top-header > div").clone().appendTo(".side-menu-login");
        $(".navbar-collapse").clone().appendTo(".side-menu-nav");
        $(".top-search-holder").clone().appendTo(".side-menu-search");

        $('#user-status-switch').on('click', function () {
            $('.panel-enter-code, .top-green-status').toggleClass('on');
            return false;
        }).toggleText('<i class="fa fa-copy marr5"></i><a href="#" id="promo-code-open" class="no-decoration">(voir tout)</a>', '<i class="fa fa-minus marr5"></i><a href="#" id="promo-code-open" class="no-decoration"> (minimiser)</a>');


        $('#left-promo-code-trigger').on('click', function (e) {
            $('.left-promo-code').toggleClass("on");
            $('#left-promo-code-trigger .fa-caret-down').toggleClass("white");
            e.preventDefault();
        });

        $('#filters-open-adaptive').on('click', function () {
            $(this).toggleClass("green");
            if ($('.content-left').is(".on")) {
                filtersPanelState('off');
            } else {
                filtersPanelState('on');
                $(".canavas").removeClass('on');
            }
        });

        $('.chosen-select').chosen({allow_single_deselect: false});

    });

    window.onload = function () {


        //$("#pagination").hide();
        if (typeof(Storage) !== "undefined") {
            if (gon && gon.current_customer === null && localStorage.getItem("plush_temporary_email") !== null) {
                $.ajax({
                    method: 'POST',
                    //url: '/orange/lu/api/automatic_login',
                    data: {
                        'plush_phone_number': localStorage.getItem("plush_phone_number")
                    },
                    dataType: 'json',
                    success: function (response) {
                        if (0 === response.status) {
                            $(".login-holder").empty();
                            if (gon && gon.locale === "fr") {
                                autoLoginMenuFR = "<li>" +
                                    "<a href=\"/fr/mon-compte/sign_out\" data-method=\"delete\" id=\"logout\" rel=\"nofollow\">DÃ©connexion</a> <span>(4dae@plush.temp)</span>" +
                                    "</li>" +
                                    "<li>" +
                                    "<a href='fr/mon-compte/' + response.current_customer_id + '>Mon compte</a>" +
                                    "</li>";
                                $(".login-holder").html(autoLoginMenuFR);
                            } else if (gon && gon.locale === "nl") {
                                autoLoginMenuNL = "<li>" +
                                    "<a href=\"/nl/mijn-account/sign_out\" data-method=\"delete\" id=\"logout\" rel=\"nofollow\">Uitloggen</a> <span>(4dae@plush.temp)</span>" +
                                    "</li>" +
                                    "<li>" +
                                    "<a href='/nl/mijn-account/' + response.current_customer_id + '>Mijn account</a>" +
                                    "</li>";
                                $(".login-holder").html(autoLoginMenuNL);
                            } else if (gon && gon.locale === "en") {
                                autoLoginMenuEN = "<li>" +
                                    "<a href=\"/en/my-account/sign_out\" data-method=\"delete\" id=\"logout\" rel=\"nofollow\">Log out</a> <span>(4dae@plush.temp)</span>" +
                                    "</li>" +
                                    "<li>" +
                                    "<a href='/en/my-account/' + response.current_customer_id + '>My account</a>" +
                                    "</li>";
                                $(".login-holder").html(autoLoginMenuEN);
                            }
                        }
                    },
                    error: function (response) {
                        console.log('CHECKED AJAX ERROR!!!');
                    }
                });
            }
        } else {
            console.log("Sorry! No Web Storage support..");
        }
    };

    $(document).ready(function () {

        $('a[rel*=facebox]').facebox();

        var originalLeave = $.fn.popover.Constructor.prototype.leave;
        $.fn.popover.Constructor.prototype.leave = function (obj) {
            var self = obj instanceof this.constructor ? obj : $(obj.currentTarget)[this.type](this.getDelegateOptions()).data('bs.' + this.type);
            originalLeave.call(this, obj);

            if (obj.currentTarget) {
                self.$tip.one('mouseenter', function () {
                    clearTimeout(self.timeout);
                    self.$tip.one('mouseleave', function () {
                        $.fn.popover.Constructor.prototype.leave.call(self, self);
                    });
                })
            }
        };

        function popoverTrig() {
            $('.popper').popover({
                placement: "left",
                trigger: "hover",
                container: 'body',
                html: true,
                delay: {
                    show: 300,
                    hide: 100
                },
                content: function () {
                    return $(this).next('.synopsys-content').html();
                }
            })
        };

        // home slider
        $('.responsive-carousel').slick({
            dots: false,
            infinite: false,
            speed: 200,
            slidesToShow: 4,
            slidesToScroll: 2,
            responsive: [
                {
                    breakpoint: 980,
                    settings: {
                        slidesToShow: 3,
                        slidesToScroll: 2,
                    }
                },
                {
                    breakpoint: 600,
                    settings: {
                        slidesToShow: 2,
                        slidesToScroll: 1
                    }
                }
            ]
        });

        //raty stars
        $('.slide-score').raty({
            readOnly: true,
            score: function () {
                return $(this).attr('data-score');
            }
        });

        // synopsis adaptive trigg open
        $('.synopsys-adaptive-open').on('click', function () {
            $('.synopsys-adaptive-open').removeClass('hidden');
            $(this).addClass('hidden');
            $('.synopsys-content').removeClass('on');
            $(this).prev('.synopsys-content').addClass('on');
            return false;
        })

        // synopsis adaptive trigg close
        $('.synopsys-adaptive-close').on('click', function () {
            $(this).closest('.slick-slide').children('.synopsys-adaptive-open').removeClass('hidden');
            $(this).closest('.grid-slide').children('.synopsys-adaptive-open').removeClass('hidden');
            $(this).closest('.synopsys-content').removeClass('on');

            return false;
        })

        // modernizr
        function checkModernizr() {
            if (Modernizr.mq('(min-width: 981px)')) {
                popoverTrig();
                fancyboxBinder();
            }
            if (Modernizr.mq('(max-width: 980px)')) {
                $('.popper').popover('destroy');
                fancyboxUnBinder();
            }
        }

        // the call to checkMq here will execute after the document has loaded
        checkModernizr();

        $(window).resize(function () {
            checkModernizr();
        });

        $('.tags-autocomplete-holder li.ui-menu-item').on('click', function (e) {
            e.preventDefault();
        });

        function fancyboxBinder() {
            $(".fancybox").unbind('click')
            $("a.fancybox").fancybox({
                padding: 5,
                helpers: {
                    overlay: {
                        locked: false,
                        overlayShow: true
                    }
                },
            })
        }

        function fancyboxUnBinder() {
            $.fancybox.close();
            $(".fancybox").bind('click', function (e) {
                e.preventDefault();
            })
            $(document).unbind('click.fb-start');
        }

    });

    $(".icheckbox,.iradio").iCheck({
        checkboxClass: 'icheckbox_minimal-grey',
        radioClass: 'iradio_minimal-grey'
    });
</script>

<#%= javascript_include_tag *webpack_asset_paths("application") %>

</body>
</html>
